<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blog - DangTyn8n AI Agent & Automation</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container { max-width: 1200px; margin: 0 auto; }

    header {
      text-align: center;
      color: white;
      padding: 40px 20px;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 3rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    header p { font-size: 1.2rem; opacity: 0.9; }

    .nav-links {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .blog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .blog-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      display: flex;
      flex-direction: column;
    }

    .blog-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    }

    .blog-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: block;
    }

    .blog-content { 
      padding: 25px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .blog-category {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85rem;
      margin-bottom: 10px;
      width: fit-content;
    }

    .blog-title {
      font-size: 1.5rem;
      margin: 10px 0;
      color: #2d3748;
      line-height: 1.3;
      flex-grow: 0;
    }

    .blog-excerpt {
      color: #718096;
      margin: 15px 0;
      font-size: 0.95rem;
      line-height: 1.6;
      flex-grow: 1;
    }

    .blog-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e2e8f0;
      font-size: 0.85rem;
      color: #718096;
    }

    .blog-author { font-weight: 600; }

    .blog-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .tag {
      background: #edf2f7;
      color: #4a5568;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
    }

    .loading {
      text-align: center;
      color: white;
      font-size: 1.5rem;
      padding: 40px;
    }

    .error {
      background: #fed7d7;
      color: #c53030;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 600px;
      margin: 40px auto;
    }

    .back-home {
      display: inline-block;
      background: white;
      color: #667eea;
      padding: 12px 30px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
    }

    .back-home:hover {
      background: #667eea;
      color: white;
      transform: translateX(-5px);
    }

    @media (max-width: 768px) {
      header h1 { font-size: 2rem; }
      .blog-grid { grid-template-columns: 1fr; }
      .nav-links { flex-direction: column; align-items: center; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <!-- Navigation Links -->
      <nav class="nav-links">
        <a href="../index.html" class="back-home">‚Üê Trang ch·ªß</a>
        <a href="../podcast/index.html" class="back-home">üìª Podcast</a>
      </nav>

      <h1>ü§ñ Blog AI Agent & Automation</h1>
      <p>Ki·∫øn th·ª©c v√† h∆∞·ªõng d·∫´n v·ªÅ n8n, AI Agent v√† T·ª± ƒë·ªông h√≥a</p>
    </header>

    <div id="blogContainer" class="loading">ƒêang t·∫£i b√†i vi·∫øt...</div>
  </div>

  <!-- Local data fallback (ph·∫£i n·∫±m ƒë√∫ng ƒë∆∞·ªùng d·∫´n v√¨ trang ·ªü /blog/) -->
  <script src="../data/posts-data.js"></script>

  <script>
    // ===== CONSTANTS =====
    const FALLBACK_IMG = '../assets/images/blog-placeholder.png';

    // ===== UTILITIES =====
    function formatDate(dateString) {
      const date = new Date(dateString);
      if (Number.isNaN(date.getTime())) return '';
      return date.toLocaleDateString('vi-VN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }

    function normalizePosts(raw) {
      // raw c√≥ th·ªÉ l√† {posts:[...]} ho·∫∑c [...] (fallback)
      if (raw && Array.isArray(raw.posts)) return raw.posts;
      if (Array.isArray(raw)) return raw;
      return [];
    }

    function safeText(value) {
      return String(value ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // ===== MAIN FUNCTION =====
    async function loadBlogs() {
      const container = document.getElementById('blogContainer');

      try {
        let rawData = null;

        // 1) ∆Øu ti√™n fetch file JSON th·∫≠t
        try {
          const response = await fetch('../data/posts.json');
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          rawData = await response.json();
        } catch (e) {
          // 2) Fallback v·ªÅ local JS n·∫øu fetch l·ªói
          console.warn('‚ö†Ô∏è Blog fetch failed, using local data fallback', e);
          rawData = window.BLOG_DATA;
        }

        const allPosts = normalizePosts(rawData);

        // L·ªçc b√†i ƒë√£ publish: JSON c·ªßa b·∫°n d√πng published: true
        const posts = allPosts.filter(p => p && p.published === true);

        if (posts.length === 0) {
          container.className = '';
          container.innerHTML = '<div class="error">üì≠ Ch∆∞a c√≥ b√†i vi·∫øt n√†o ƒë∆∞·ª£c xu·∫•t b·∫£n.</div>';
          return;
        }

        // Sort b√†i vi·∫øt m·ªõi nh·∫•t l√™n tr∆∞·ªõc
        posts.sort((a, b) => new Date(b.date) - new Date(a.date));

        // ===== RENDER BLOG GRID =====
        container.className = 'blog-grid';
        container.innerHTML = posts.map(post => {
          const title = post.title || 'B√†i vi·∫øt';
          
          // ∆Øu ti√™n featuredImage > image > fallback placeholder
          const imageUrl = post.featuredImage || post.image || FALLBACK_IMG;
          
          const category = post.category || (post.tags && post.tags[0]) || 'Blog';
          const excerpt = post.excerpt || post.description || '';
          const author = post.author || '';
          const readTime = (post.readTime != null) ? `${post.readTime} ph√∫t` : '';
          const dateText = post.date ? formatDate(post.date) : '';

          return `
            <div class="blog-card" onclick="window.location.href='detail.html?slug=${encodeURIComponent(post.slug)}'">
              <!-- Featured Image v·ªõi fallback -->
              <img 
                src="${imageUrl}" 
                alt="${safeText(title)}" 
                class="blog-image"
                loading="lazy"
                onerror="this.onerror=null; this.src='${FALLBACK_IMG}';"
              />
              
              <div class="blog-content">
                <span class="blog-category">${safeText(category)}</span>
                <h2 class="blog-title">${safeText(title)}</h2>
                <p class="blog-excerpt">${safeText(excerpt)}</p>

                <!-- Tags Section -->
                ${Array.isArray(post.tags) && post.tags.length ? `
                  <div class="blog-tags">
                    ${post.tags.slice(0, 3).map(tag => `<span class="tag">#${safeText(tag)}</span>`).join('')}
                    ${post.tags.length > 3 ? `<span class="tag">+${post.tags.length - 3}</span>` : ''}
                  </div>
                ` : ''}

                <!-- Meta Info -->
                <div class="blog-meta">
                  ${author ? `<span class="blog-author">üë§ ${safeText(author)}</span>` : ''}
                  ${dateText ? `<span>üìÖ ${safeText(dateText)}</span>` : ''}
                  ${readTime ? `<span>‚è±Ô∏è ${safeText(readTime)}</span>` : ''}
                </div>
              </div>
            </div>
          `;
        }).join('');

      } catch (error) {
        container.className = '';
        container.innerHTML = `
          <div class="error">
            <h3>‚ùå L·ªói t·∫£i b√†i vi·∫øt</h3>
            <p>${safeText(error.message)}</p>
          </div>
        `;
      }
    }

    // ===== KH·ªûI ƒê·ªòNG =====
    loadBlogs();
  </script>
</body>
</html>
